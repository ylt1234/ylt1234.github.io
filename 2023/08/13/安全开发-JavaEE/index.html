<!DOCTYPE html>
<html lang="en">
    <head>
        
    
    <link rel='stylesheet' href="/./css/dracula.css">

        <title>安全开发-JavaEE</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2.0">
<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="manifest" href="/site.webmanifest">

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <header class="al_header al_pos_fixed">
    <div class="al_header_container dis_flex_jcenter">
        <div class="al_header_container_left">
            <div class="al_header_site_title">
                <a href="/">Hexo</a>
            </div>
        </div>

        <div class="dis_flex_jcenter">
            <div class="al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-menu"></use>
                </svg>
            </div>
        </div>
    </div>
</header>

        <div class="al_sidebar">

    <div class="al_sidebar_overlay al_full_cover"></div>

    <div class="al_pos_fixed al_sidebar_cnt">
        <div class="dis_flex_acenter al_sidebar_header">
            <h3>Hexo</h3>
            <div class="al_sidebar_close al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-close"></use>
                </svg>
            </div>
        </div>

        <div class="al_sidebar_author_cnt">

            <div class="al_sidebar_author_info">
                <h4>John Doe</h4>
                <img class="al_sidebar_avatar" src="https://yourAvatorURL">
                <p></p>
            </div>

            
        </div>
    </div>
</div>

        
    <div class="dis_flex_center al_lightbox_cnt al_full_cover">
        <img class="al_lightbox_img"/>
    </div>
    <div class="al_page_background dis_flex_center al_full_cover"></div>
    <div class="al_page_container">
        <div class="al_pos_ab al_fake_background"></div>
        <div class="al_main_container al_shadow al_main_page_container">
            <article class="al_article">
                <header>
                    <h1 class="al_page_title">
                        安全开发-JavaEE
                    </h1>
                    <div class="al_page_info dis_flex">
                        <div class="al_page_content_info">
                            Sun August 13, 2023 08:44 AM
                        </div>

                        

                        
                        <span class="tags"></span>
                    </div>
                </header>

                
                    <div class="al_page_content_outline">
                        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">开发环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-text">Java项目的结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Servlet"><span class="toc-text">Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8Servlet"><span class="toc-text">创建和使用Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IndexServlet"><span class="toc-text">IndexServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-xml"><span class="toc-text">web.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">Servlet的生命周期</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8JDBC%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">用JDBC操作数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyselectServlet"><span class="toc-text">MyselectServlet</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Filter"><span class="toc-text">Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4XSS"><span class="toc-text">过滤XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TestServlet"><span class="toc-text">TestServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XssFilter"><span class="toc-text">XssFilter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie%E9%AA%8C%E8%AF%81"><span class="toc-text">cookie验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AdminServlet"><span class="toc-text">AdminServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AdminFilter"><span class="toc-text">AdminFilter</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Listen"><span class="toc-text">Listen</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-2"><span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%ACsession%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81"><span class="toc-text">监听session的创建和销毁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSession"><span class="toc-text">CSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DSession"><span class="toc-text">DSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListenSession"><span class="toc-text">ListenSession</span></a></li></ol></li></ol></li></ol>
                    </div>
                

                
                <section id="post-body">
                    <h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><p>idea+Navicat Premium</p>
<p>idea：写java代码</p>
<p>Navicat Premium：数据库</p>
<h1 id="Java项目的结构"><a href="#Java项目的结构" class="headerlink" title="Java项目的结构"></a>Java项目的结构</h1><p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/1-1691843624182-2.png" alt="1"></p>
<p>写程序一般会用到的：</p>
<p>lib目录来存第三方jar文件，src&#x2F;main&#x2F;java下是java代码，webapp&#x2F;web-inf&#x2F;web.xml是配置web，比如路由的地方。</p>
<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><p>Servlet是运行在Web服务器或应用服务器上的程序,它是作为来自Web浏览器或其他HTTP客户端的请求和HTTP服务器上的数据库或应用程序之间的中间层。使用Servlet可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。本章内容详细讲解了web开发的相关内容以及servlet相关内容的配置使用,是JAVAEE开发的重中之重。</p>
<h2 id="创建和使用Servlet"><a href="#创建和使用Servlet" class="headerlink" title="创建和使用Servlet"></a>创建和使用Servlet</h2><h3 id="IndexServlet"><a href="#IndexServlet" class="headerlink" title="IndexServlet"></a>IndexServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">package com.example.servletdemo;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.SQLException;  //引入库</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/index&quot;)  //路由，这里和web.xml里作用一样，二选一即可</span><br><span class="line">public class IndexServlet extends HttpServlet &#123; //创建一个类继承HttpServlet</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;  //在有get请求的时候触发此函数</span><br><span class="line">        System.out.println(&quot;--------------doGet&quot;);  //终端输出doGET</span><br><span class="line">        String id =req.getParameter(&quot;id&quot;); //get请求接收到参数id</span><br><span class="line">        resp.setContentType(&quot;GBK&quot;);  //输出的编码</span><br><span class="line">        resp.setContentType(&quot;text/html&quot;); //输出的格式</span><br><span class="line">        PrintWriter out = resp.getWriter();   //从HttpServletResponse中get一个PrintWriter,取一个响应客户端的流对象，打个通俗的比方就是通过HttpServletResponse对象得到一支笔，然后就可以用out.print()方法在网页上写任何你想显示的内容。</span><br><span class="line">        out.println(&quot;这是GET请求的数据:&quot;); //输出到浏览器中</span><br><span class="line">        out.println(&quot;id：&quot;+id+&quot;&lt;br&gt;&quot;);</span><br><span class="line">        out.flush(); //刷新</span><br><span class="line">        out.close(); //关闭</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        String name = req.getParameter(&quot;name&quot;);</span><br><span class="line">        resp.setContentType(&quot;utf-8&quot;);</span><br><span class="line">        resp.setContentType(&quot;text/html&quot;);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(&quot;这是post提交的数据&quot;);</span><br><span class="line">        out.println(name);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">        System.out.println(&quot;--------------doPost&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void init(ServletConfig config) throws ServletException&#123;</span><br><span class="line">        System.out.println(&quot;--------------init&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;--------------destroy&quot;);</span><br><span class="line">        super.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;--------------http service&quot;);</span><br><span class="line">        super.service(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;--------------Servlet service&quot;);</span><br><span class="line">        super.service(req, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><p>这个和IndexServlet的@WebServlet(“&#x2F;index”) 二选一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">         version=&quot;4.0&quot;&gt;  //以上是自带的</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">      &lt;servlet-name&gt;index&lt;/servlet-name&gt;  //取名为index</span><br><span class="line">      &lt;servlet-class&gt;com.example.servletdemo.IndexServlet&lt;/servlet-class&gt;  //项目地址，在IndexServlet复制来的</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;index&lt;/servlet-name&gt;  //上面取的那个名字</span><br><span class="line">        &lt;url-pattern&gt;/index&lt;/url-pattern&gt;  //路由</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Servlet的生命周期"><a href="#Servlet的生命周期" class="headerlink" title="Servlet的生命周期"></a>Servlet的生命周期</h3><p>用get运行以上代码，发现结果输出顺序是init，http service，Servlet service，doGet，再次get访问输出是http service，Servlet service，doGet，结束运行后输出destroy。可得：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/2.png" alt="2"></p>
<h1 id="用JDBC操作数据库"><a href="#用JDBC操作数据库" class="headerlink" title="用JDBC操作数据库"></a>用JDBC操作数据库</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>JDBC(Java Database connectivity): 由java提供,用于访问数据库的统一API接口规范.数据库驱动: 由各个数据库厂商提供,用于访问数据库的jar包(JDBC的具体实现),遵循JDBC接口,以便java程序员使用！</p>
<p>1、下载jar</p>
<p><a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<p>2、引用封装jar</p>
<p>创建lib目录，复制导入后，添加为库</p>
<p>3、注册数据库驱动</p>
<p>Class.forName(“com.mysql.jdbc.Driver”);</p>
<p>4、建立数据库连接</p>
<p>String url &#x3D;”jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;demo01”;</p>
<p>Connection connection&#x3D;DriverManager.getConnection(url,”x”,”x”);</p>
<p>5、创建Statement执行SQL</p>
<p>Statement statement&#x3D; connection.createStatement();</p>
<p>ResultSet resultSet &#x3D; statement.executeQuery(sql);</p>
<p>6、结果ResultSet进行提取</p>
<p>while (resultSet.next()){</p>
<p>​    int id &#x3D; resultSet.getInt(“id”);</p>
<p>​    String page_title &#x3D; resultSet.getString(“page_title”);</p>
<p>​    …….</p>
<p>}</p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><p>把下载的jar放到lib里，右键执行下</p>
<h2 id="MyselectServlet"><a href="#MyselectServlet" class="headerlink" title="MyselectServlet"></a>MyselectServlet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo02;</span><br><span class="line"></span><br><span class="line">import java.sql.*;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class NewsServlet &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, SQLException &#123;</span><br><span class="line"></span><br><span class="line">        //接受用户输入的 变量字符串s接受</span><br><span class="line">        Scanner scanner=new Scanner(System.in);</span><br><span class="line">        System.out.print(&quot;pelease input id:&quot;);</span><br><span class="line">        String s=scanner.nextLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Class.forName(&quot;com.mysql.jdbc.Driver&quot;); //注册数据库驱动</span><br><span class="line">        String url =&quot;jdbc:mysql://localhost:3306/dome01&quot;;</span><br><span class="line">        Connection connection = DriverManager.getConnection(url,&quot;root&quot;,&quot;123456&quot;);</span><br><span class="line">        System.out.println(connection); //连接数据库</span><br><span class="line"></span><br><span class="line">        //不安全的写法</span><br><span class="line">      String sql=&quot;select * from new where id=&quot;+s; //sql语句</span><br><span class="line">      System.out.println(sql); //输出sql语句</span><br><span class="line">      Statement statement= connection.createStatement(); </span><br><span class="line">      ResultSet resultSet = statement.executeQuery(sql); //执行</span><br><span class="line"></span><br><span class="line">        //预编译写法</span><br><span class="line">       /* String safesql=&quot;select * from news where id=?&quot;;</span><br><span class="line">        PreparedStatement preparedStatement=connection.prepareStatement(safesql); //预编译</span><br><span class="line">        preparedStatement.setString(1,s);</span><br><span class="line">        ResultSet resultSet=preparedStatement.executeQuery(); //执行sql语句</span><br><span class="line">        System.out.println(safesql);*/</span><br><span class="line"></span><br><span class="line">        while (resultSet.next())&#123; 结果遍历赋值输出</span><br><span class="line">            int id = resultSet.getInt(&quot;id&quot;);</span><br><span class="line">            String page_title = resultSet.getString(&quot;page_title&quot;);</span><br><span class="line">            String heading = resultSet.getString(&quot;heading&quot;);</span><br><span class="line">            String subheading = resultSet.getString(&quot;subheading&quot;);</span><br><span class="line">            String content = resultSet.getString(&quot;content&quot;);</span><br><span class="line">            String img = resultSet.getString(&quot;img&quot;);</span><br><span class="line">            System.out.println(id+&quot;|&quot;+page_title+&quot;|&quot;+heading+&quot;|&quot;+subheading+&quot;|&quot;+content+&quot;|&quot;+img);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/4.png" alt="4"></p>
<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><p>Filter被称为过滤器，过滤器实际上就是对Web资源进行拦截，做一些处理后再交给下一个过滤器或Servlet处理，通常都是用来拦截request进行处理的，也可以对返回的 response进行拦截处理。开发人员利用filter技术，可以实现对所有Web资源的管理，例如实现权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。</p>
<h2 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h2><p>1、创建过滤器</p>
<p>2、过滤器内置方法</p>
<p>init doFilter destroy</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/5.png" alt="5"></p>
<h2 id="过滤XSS"><a href="#过滤XSS" class="headerlink" title="过滤XSS"></a>过滤XSS</h2><h3 id="TestServlet"><a href="#TestServlet" class="headerlink" title="TestServlet"></a>TestServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;  </span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/test&quot;)</span><br><span class="line">public class  TestServlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        String code =req.getParameter(&quot;code&quot;); //接收参数</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(code);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XssFilter"><a href="#XssFilter" class="headerlink" title="XssFilter"></a>XssFilter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.filter;</span><br><span class="line"></span><br><span class="line">import javax.servlet.*;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/test&quot;)</span><br><span class="line">public class XssFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    //中间件启动后就自动运行</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;xss开启过滤&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //中间件关闭后就自动运行</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;xss销毁过滤&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //doFilter 访问路由触发的方法</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">        System.out.println(&quot;xss正在过滤&quot;);</span><br><span class="line">        //过滤代码就应该在放行前</span><br><span class="line">        //如果符合就放行，不符合就过滤（拦截）</span><br><span class="line">        //XSS过滤 接受参数值 如果有攻击payload 就进行拦截</span><br><span class="line">        // 接受参数值 如果没有攻击payload 就进行放行</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest; //HttpServletRequest比ServletRequest多了一些针对于Http协议的方法。当需要使用一些Http协议方法时，需通过ServletRequest创建HttpServletRequest对象</span><br><span class="line">        String code = request.getParameter(&quot;code&quot;);</span><br><span class="line">        if(!code.contains(&quot;&lt;script&gt;&quot;))&#123; //没有攻击payload           filterChain.doFilter(servletRequest,servletResponse); //放行</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.out.println(&quot;存在XSS攻击&quot;);</span><br><span class="line">            //继续拦截</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们输入<code>/test?code=&lt;script&gt;</code>时，返回结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/6.png" alt="6"></p>
<h2 id="cookie验证"><a href="#cookie验证" class="headerlink" title="cookie验证"></a>cookie验证</h2><h3 id="AdminServlet"><a href="#AdminServlet" class="headerlink" title="AdminServlet"></a>AdminServlet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/admin&quot;)</span><br><span class="line">public class AdminServlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;欢迎进入管理员页面&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AdminFilter"><a href="#AdminFilter" class="headerlink" title="AdminFilter"></a>AdminFilter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.example.filterdemo1.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import javax.servlet.*;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/admin&quot;)</span><br><span class="line">public class AdminFileter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;admin身份检测开启&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;admin身份检测销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;admin身份检测进行&quot;);</span><br><span class="line">        //检测Cookie过滤</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest;</span><br><span class="line">        Cookie[] cookies=request.getCookies(); //接收cookies给cookies变量</span><br><span class="line">        //对Cookie进行遍历获取</span><br><span class="line">        for(Cookie c:cookies)&#123; //因为cookie可能有多个，所以用数组</span><br><span class="line">            String cName = c.getName();//获取cookie名</span><br><span class="line">            String cValue = c.getValue();//获取cookie值</span><br><span class="line">            System.out.println(cName);</span><br><span class="line">            System.out.println(cValue);</span><br><span class="line">            if(cName.contains(&quot;user&quot;) &amp;&amp; cValue.contains(&quot;admin&quot;))&#123;</span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse); //放行</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                System.out.println(&quot;非管理员访问&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当访问<code>/admin</code>时，返回结果：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/7.png" alt="7"></p>
<h1 id="Listen"><a href="#Listen" class="headerlink" title="Listen"></a>Listen</h1><h2 id="基础知识-2"><a href="#基础知识-2" class="headerlink" title="基础知识"></a>基础知识</h2><p>-监听ServletContext、HttpSession、ServletRequest等域对象创建和销毁事件</p>
<p>-监听域对象的属性发生修改的事件</p>
<p>-监听在事件发生前、发生后做一些必要的处理</p>
<p>监听器的用途</p>
<ul>
<li><p>统计在线人数和用户</p>
</li>
<li><p>系统启动的时候加载初始化信息</p>
</li>
<li><p>统计网站的访问量</p>
</li>
</ul>
<p>监听器安全场景：代码审计中分析执行逻辑触发操作，红队内存马植入，蓝队清理内存马等</p>
<h2 id="监听session的创建和销毁"><a href="#监听session的创建和销毁" class="headerlink" title="监听session的创建和销毁"></a>监听session的创建和销毁</h2><h3 id="CSession"><a href="#CSession" class="headerlink" title="CSession"></a>CSession</h3><p>实现功能创建session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.Servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.*;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/cs&quot;)</span><br><span class="line">public class CSession extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;  //get请求的时候调用</span><br><span class="line">        System.out.println(&quot;Servlet里面创建Session&quot;);</span><br><span class="line">        req.getSession();        //创建Session</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概意思就是在访问&#x2F;cs时创建session</p>
<h3 id="DSession"><a href="#DSession" class="headerlink" title="DSession"></a>DSession</h3><p>实现功能销毁session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.Servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/ds&quot;)</span><br><span class="line">public class DSession extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;Servlet里面销毁Session&quot;);</span><br><span class="line">        req.getSession().invalidate();    //销毁Session</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概意思就是在访问&#x2F;ds时销毁session</p>
<h3 id="ListenSession"><a href="#ListenSession" class="headerlink" title="ListenSession"></a>ListenSession</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.example.listendemo1.listener;</span><br><span class="line"></span><br><span class="line">import javax.servlet.annotation.WebListener;</span><br><span class="line">import javax.servlet.http.HttpSessionEvent;</span><br><span class="line">import javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line">@WebListener //用@WebListener注解就实现监听</span><br><span class="line">public class ListenSession implements HttpSessionListener &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionCreated(HttpSessionEvent se) &#123;</span><br><span class="line">        //监听检测有Session创建就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session创建&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionDestroyed(HttpSessionEvent se) &#123;</span><br><span class="line">        //监听检测有Session销毁就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为访问网站就会创建一个session，所以我用&#x2F;ds，&#x2F;cs，&#x2F;ds的顺序访问网站，结果如图：</p>
<p><img src="/2023/08/13/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JavaEE/8.png" alt="8"></p>

                </section>

                
                

                

            </article>

            
            <nav class="dis_flex al_post_nav">
                <a class="al_post_nav_item dis_flex_acenter" href="/">
                    
                </a>
                <a class="al_post_nav_item dis_flex_acenter" href="/2023/08/09/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91-JS/">
                    
                        <span class="al_text_ellipsis al_post_nav_desc">安全开发-JS</span>
                        <svg class="al_arrow">
                            <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-arrow-right"></use>
                        </svg>
                    
                </a>
            </nav>
        </div>
    </div>


        <div class="al_index_footer dis_flex_center">
    <div class="al_index_footer_item al_index_footer_title">
        John Doe
    </div>

    
    

    <div class="al_index_footer_item al_index_footer_extra">
        Created By 
        <a target="_blank" rel="noopener" href="https://github.com/iGuan7u/Acetolog">AcetoLog</a>
         · Power By 
        <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
    </div>

    <div class="al_index_footer_item al_index_footer_extra_right">
        All Right Reserved
    </div>
</div>

        <script type="text/javascript" async="async" src="/javascripts/acelog.js"></script>
        
        
        
        
        

    </body>
</html>